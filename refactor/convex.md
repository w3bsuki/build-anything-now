# Task 6: Convex Backend Cleanup

> **Goal:** Audit the Convex backend — schema, queries, mutations, actions. Remove dead exports, unused tables, over-engineered patterns. Keep functional code lean.

---

## Your Process

1. **Read Convex best practices docs** — focus on schema design, query patterns, mutation security, and function organization.
2. **Audit `convex/schema.ts`** (699 lines) — identify unused tables, over-specified fields, or tables that exist but have no queries/mutations.
3. **Audit each function file** — check for dead exports, unused internal helpers, duplicate logic.
4. **Do NOT touch `convex/_generated/`** — these files are auto-generated by Convex.
5. **Verify** — `npx convex typecheck` or `pnpm exec tsc -p convex/tsconfig.json --noEmit` must pass.

---

## Files to Audit

### `convex/schema.ts` (699 lines)

This is a massive schema file. For each table defined:
1. Check if there are corresponding query/mutation files that use this table.
2. Check if the table is referenced by any frontend code.
3. If a table is defined but has NO queries, mutations, or frontend references → flag for removal.
4. Look for over-specified optional fields that add complexity without value.

### Function Files

For each file, check:
- Are all exported functions (`query`, `mutation`, `action`) imported/used by the frontend?
- Are there internal helpers that are never called?
- Is there dead/commented-out code?

Files:
- `convex/achievements.ts`
- `convex/activity.ts`
- `convex/campaigns.ts`
- `convex/cases.ts`
- `convex/clinics.ts`
- `convex/community.ts`
- `convex/devSeed.ts` — is this still used? If seeding was a one-time thing, consider removing.
- `convex/donations.ts`
- `convex/home.ts`
- `convex/http.ts` — HTTP routes (webhooks etc)
- `convex/notifications.ts`
- `convex/partners.ts`
- `convex/paymentMethods.ts`
- `convex/petServices.ts` — what is this? Is it used?
- `convex/reports.ts`
- `convex/settings.ts`
- `convex/social.ts` — what does this cover? Is it used?
- `convex/storage.ts`
- `convex/translate.ts` — translation backend? Check if used.
- `convex/users.ts`
- `convex/volunteers.ts`

### `convex/svix.d.ts`

This is a type declaration file for Svix (webhook service). Check if Svix is actually used or if webhooks go through a different path. If Svix is not a dependency, remove this.

### `convex/lib/auth.ts`

Auth helper utilities. Verify they're used and follow the patterns described in `DESIGN.md`.

### `convex/auth.config.ts`

Clerk auth configuration for Convex. Verify it's correct and minimal.

### `convex/tsconfig.json`

Check for alignment with Convex's expected TypeScript configuration.

---

## What to Look For

1. **Dead tables** — defined in schema but no functions operate on them
2. **Dead exports** — functions exported but never imported by frontend
3. **Duplicate logic** — auth checks or data fetching patterns copy-pasted across files
4. **Over-engineering** — complex generic patterns where simple direct code would suffice
5. **devSeed.ts** — if this is only for dev, ensure it's not accidentally callable in production (should use `internalMutation`)
6. **Commented-out code** — delete it, git has history

---

## Verification

```bash
# Verify Convex types compile
pnpm exec tsc -p convex/tsconfig.json --noEmit

# If you have Convex dev running, verify functions deploy
npx convex typecheck
```

---

## Commit
```
refactor: clean Convex schema and functions — remove dead tables, exports, duplication
```
