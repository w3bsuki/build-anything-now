# Pawtreon — Full Repo Audit (Codex)

> **Date:** 2026-01-23  
> **Scope:** entire repo (`src/`, `convex/`, mobile wrappers, docs)  
> **Goal:** trust-first MVP readiness + spec-driven execution plan for OPUS

---

## Treido Audit — 2026-01-23

### Critical (blocks release / trust posture)
- [ ] **Unauthenticated onboarding mutation allows account/role tampering** → `convex/users.ts` (`completeOnboarding` accepts `email` fallback) → require auth; remove email path.
- [ ] **Dev-only mutations/queries are publicly callable** → `convex/users.ts` (`listAll`, `resetOnboarding`) → make admin-gated or `internalMutation`/`internalQuery`.
- [ ] **Public query leaks user email via volunteer profile** → `convex/volunteers.ts` (`get` returns `email`) → remove or only return to owner/admin.
- [ ] **“Internal use” mutation is publicly callable** → `convex/achievements.ts` (`award`) → convert to `internalMutation` or enforce server-side awarding rules.

### High (next sprint)
- [ ] **Unbounded reads + in-memory filtering** → many `ctx.db.query(...).collect()` patterns in `convex/*` → add pagination + indexed filtering (especially feed/cases/community/clinics/users).
- [ ] **Placeholder actions / dead-ish CTAs** → multiple `console.log(...)` handlers in UI (`src/pages/Notifications.tsx`, `src/pages/PaymentMethods.tsx`, `src/pages/Settings.tsx`, etc.) → replace with real Convex mutations or hide the actions behind “Coming soon”.
- [ ] **Package manager drift** → repo has `pnpm-lock.yaml`, `package-lock.json`, `bun.lockb` → decide one (recommend `pnpm`) and remove the others to prevent dependency skew.
- [ ] **Docs drift risk** → canonical docs exist at repo root but are currently untracked; older GPT audits in `docs/archive/gpt/*` contain stale claims → ensure root docs are canonical + update archive README to mark older audits as historical.

### Deferred (backlog / Phase 2+)
- [ ] **Volunteer coordination map + online status** → requires privacy model + location precision controls → spec in PRD/TODO before building.
- [ ] **SSR share pages (OpenGraph)** → per `TECH-STACK.md`; ship as separate small SSR layer.
- [ ] **Real payments + receipts** → Stripe (recommended) + idempotent webhooks + audit trail; requires `TRUST-SAFETY.md` gating rules.

---

## Tailwind Lane Phase 1 Audit — 2026-01-23

### Critical (blocks Phase 2)
- [ ] **Hardcoded Tailwind palette used in product UI** → e.g. `text-red-500`, `bg-green-500`, `border-rose-200` → files like `src/components/EmergencyBanner.tsx`, `src/pages/CommunityMembers.tsx`, `src/pages/onboarding/ClaimOrganizationPage.tsx` → replace with semantic tokens (`text-primary`, `bg-muted`, `bg-success`, etc.) and ensure dark-mode parity.

### High (do in Phase 2)
- [ ] **Gradients + “visual noise”** → e.g. `bg-gradient-to-*`, `bg-linear-to-*` overlays in `src/components/CaseCard.tsx`, `src/components/CampaignCard.tsx`, `src/components/EmergencyBanner.tsx` → either remove or standardize as a single tokenized pattern.
- [ ] **Arbitrary values in app components** → many `text-[11px]`, `w-[160px]`, `min-h-[88px]`, etc. across `src/pages/*` and `src/components/*` → consolidate into consistent scale (`text-xs`, `w-40`, `min-h-22`) where it improves consistency.

### Deferred (Phase 3 or backlog)
- [ ] **Token consolidation** → `src/index.css` defines theme tokens; also `src/fonts.css` defines `--font-sans` → consolidate to one canonical source to match `STYLE.md` (“`src/index.css` wins”).

---

## Architecture notes (for OPUS execution)

- **Backend boundary (Convex):** only `internal*` functions may accept identity-less identifiers like email/clerkId; public functions must derive identity from `ctx.auth.getUserIdentity()` and enforce ownership/role checks.
- **Frontend boundary (Vite/React Router):** any screen that shows identity-sensitive data must be `AuthGuard`’d; “public profile” endpoints must return an explicit public shape (no email/PII).
- **Rollout:** fix Critical items first, then run `pnpm lint`, `pnpm exec tsc -p tsconfig.app.json --noEmit`, `pnpm build` as the definition-of-done gate.

